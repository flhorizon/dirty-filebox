<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 
<html lang="en"> 
    <head> 
        <meta http-equiv="content-type" content="text/html; charset=utf-8"> 
        <title>Upload stuff</title>
        <style>
            html,head,body { padding:0; margin:0; }
            body { font-family: calibri, helvetica, arial, sans-serif; }
        </style>
        <script type="text/javascript" src="Elm.js"></script>
    </head>
<body>
        <script type="text/javascript">
            var app = Elm.Main.fullscreen();
            
            app.ports.fileSelected.subscribe(function (id) {
                var node = document.getElementById(id);
                if (node === null) {
                    console.log("Node doesn't exist.")
                    return;
                }
            
                // If your file upload field allows multiple files, you might
                // want to consider turning this into a `for` loop.
                var file = node.files[0];
                var reader = new FileReader();
            
                // FileReader API is event based. Once a file is selected
                // it fires events. We hook into the `onload` event for our reader.
                reader.onload = (function(event) {
                    // The event carries the `target`. The `target` is the file
                    // that was selected. The result is base64 encoded contents of the file.
                    var base64encoded = event.target.result;
                    // We build up the `ImagePortData` object here that will be passed to our Elm
                    // runtime through the `fileContentRead` subscription.
                    var portData = {
                        contents: base64encoded,
                        filename: file.name
                    };
            
                    // We call the `fileContentRead` port with the file data
                    // which will be sent to our Elm runtime via Subscriptions.
                    app.ports.fileContentRead.send(portData);
                });
            
                // Connect our FileReader with the file that was selected in our `input` node.
                reader.readAsDataURL(file);
            });
        </script>
        <noscript>
            Hello ?!
        </noscript>
</body> 
</html> 
